<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Are The Courts Open? - Central Park</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=sports_tennis" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .status-open {
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
        }
        .status-closed {
            box-shadow: 0 0 20px rgba(248, 113, 113, 0.5);
        }
        .weather-card {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50">
    <div class="container mx-auto px-4 py-12">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-2">
                <!-- <img src="{{ url_for('static', filename='Tr.svg') }}" alt="Tennis Racket" class="text-5xl mx-auto"> -->
                
                Are The Courts Open?
            </h1>
            <p class="text-lg text-gray-600">Central Park Tennis Courts Status</p>
            <div id="lastUpdated" class="text-sm text-gray-500">Last updated: --</div>
        </header>

        <main class="max-w-3xl mx-auto">
            <div id="statusCard" class="bg-white rounded-xl p-8 mb-8 transition-all duration-500">
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <div class="flex items-center mb-4 md:mb-0">
                        <div id="statusIcon" class="text-5xl mr-6">
                            <i class="fas fa-table-tennis"></i>
                        </div>
                        <div>
                            <h2 class="text-2xl font-semibold text-gray-800">Central Park Tennis Courts</h2>
                            <p class="text-gray-500">New York, NY</p>
                        </div>
                    </div>
                    <div class="text-center md:text-right">
                        <div id="statusText" class="text-3xl font-bold mb-1">Checking...</div>
                        <div id="statusSubtext" class="text-lg">Loading current status</div>
                    </div>
                </div>
            </div>

            <div id="notesSection" class="bg-amber-50 border-l-4 border-amber-400 p-4 mb-8 rounded-lg hidden">
                <div class="flex items-start">
                    <i class="fas fa-sticky-note text-amber-500 mt-1 mr-3"></i>
                    <div>
                        <h3 class="font-medium text-amber-800">Court Notes</h3>
                        <p id="notesText" class="text-amber-700 mt-1"></p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div class="weather-card p-5 bg-white border border-gray-100 shadow-xs hover:shadow-sm transition-all">
                    <div class="flex items-center">
                        <i class="fas fa-temperature-high text-2xl text-red-400 mr-4"></i>
                        <div>
                            <h3 class="font-medium text-gray-500 text-xs uppercase tracking-wider">Temperature</h3>
                            <div id="temp" class="text-2xl font-semibold text-gray-800">--°F</div>
                        </div>
                    </div>
                </div>
            
                <div class="weather-card p-5 bg-white border border-gray-100 shadow-xs hover:shadow-sm transition-all">
                    <div class="flex items-center">
                        <i class="fas fa-cloud-rain text-2xl text-blue-400 mr-4"></i>
                        <div>
                            <h3 class="font-medium text-gray-500 text-xs uppercase tracking-wider">Chance of Rain</h3>
                            <div id="precip" class="text-2xl font-semibold text-gray-800">--%</div>
                        </div>
                    </div>
                </div>
            
                <div class="weather-card p-5 bg-white border border-gray-100 shadow-xs hover:shadow-sm transition-all">
                    <div class="flex items-center space-x-4">
                      <i class="text-2xl text-indigo-400"></i>
                      <div class="min-w-0">
                        <h3 class="font-medium text-gray-500 text-xs uppercase tracking-wider">Forecast</h3>
                        <div id="conditions" class="text-2xl font-medium text-gray-800 truncate break-words max-w-[12rem]">
                          --
                        </div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl overflow-hidden">
                <iframe 
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d6639.319113314451!2d-73.9620658!3d40.789886599999996!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c25988f989506d%3A0x6d87771a059466ba!2sCentral%20Park%20Tennis%20Center!5e1!3m2!1sen!2sus!4v1755451031278!5m2!1sen!2sus" 
                    width="100%" 
                    height="300" 
                    style="border:0;" 
                    allowfullscreen="" 
                    loading="lazy" 
                    referrerpolicy="no-referrer-when-downgrade"
                    class="rounded-b-xl"
                ></iframe>
            </div>
        </main>

        <footer class="mt-16 text-center text-gray-500 text-sm">
            <p class="mt-2">© 2025 arethecourtsopen.com |  <b>Not</b> affiliated with NYC Parks.</p>
        </footer>
    </div>

    <script>
        async function fetchCourtStatus() {
            try {
                const response = await fetch('/api/status');
                if (!response.ok) {
                    throw new Error('Failed to fetch status');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching court status:', error);
                window.location.href = 'https://www.nycgovparks.org/tennis/';
            }
        }

        async function updateStatus() {
            const statusData = await fetchCourtStatus();
            
            const statusCard = document.getElementById('statusCard');
            const statusIcon = document.getElementById('statusIcon');
            const statusText = document.getElementById('statusText');
            const statusSubtext = document.getElementById('statusSubtext');
            
            statusCard.classList.remove('status-open', 'status-closed', 'bg-green-50', 'bg-red-50', 'bg-yellow-50', 'bg-gray-100');
            
            switch (statusData.status) {
                case 'open':
                    statusCard.classList.add('status-open', 'bg-green-50');
                    statusIcon.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
                    statusText.textContent = 'OPEN';
                    statusText.className = 'text-3xl font-bold mb-1 text-green-600';
                    statusSubtext.textContent = '\n';
                    statusSubtext.className = 'text-lg text-green-700';
                    break;
                    
                case 'closed':
                    statusCard.classList.add('status-closed', 'bg-red-50');
                    statusIcon.innerHTML = '<i class="fas fa-times-circle text-red-500"></i>';
                    statusText.textContent = 'CLOSED';
                    statusText.className = 'text-3xl font-bold mb-1 text-red-600';
                    statusSubtext.textContent = '\n';
                    statusSubtext.className = 'text-lg text-red-700';
                    break;

                case 'closed_until':
                    statusCard.classList.add('bg-yellow-50');
                    statusIcon.innerHTML = '<i class="fas fa-clock text-yellow-500"></i>';
                    statusText.textContent = 'CLOSED UNTIL';
                    statusText.className = 'text-3xl font-bold mb-1 text-yellow-600';
                    statusSubtext.textContent = 'Courts temporarily closed';
                    statusSubtext.className = 'text-lg text-yellow-700';
                    break;
                        
                default:
                    statusCard.classList.add('bg-gray-100');
                    statusIcon.innerHTML = '<i class="fas fa-question-circle text-gray-500"></i>';
                    statusText.textContent = 'UNKNOWN';
                    statusText.className = 'text-3xl font-bold mb-1 text-gray-600';
                    statusSubtext.textContent = 'Status unavailable';
                    statusSubtext.className = 'text-lg text-gray-700';
            }
            
            document.getElementById('temp').textContent = `${statusData.temperature}°F`;
            document.getElementById('precip').textContent = `${statusData.precipitation}%`;
            document.getElementById('conditions').textContent = statusData.conditions;
            
            function formatTime12Hour(hour) {
                if (hour === 0) return '12:00 AM';
                if (hour < 12) return `${hour}:00 AM`;
                if (hour === 12) return '12:00 PM';
                return `${hour - 12}:00 PM`;
            }
            
            if (statusData.hours) {
                let hoursText = `${formatTime12Hour(statusData.hours.open)} - ${formatTime12Hour(statusData.hours.close)}`;
                
                if (statusData.hours_override) {
                    const today = new Date().toISOString().split('T')[0];
                    if (statusData.hours_override.date === today) {
                        hoursText = `${formatTime12Hour(statusData.hours_override.hours.open)} - ${formatTime12Hour(statusData.hours_override.hours.close)} (Today)`;
                    }
                }
                
                
            }
            
            const notesSection = document.getElementById('notesSection');
            const notesText = document.getElementById('notesText');
            
            if (statusData.notes && statusData.notes.trim() !== '') {
                notesText.textContent = statusData.notes;
                notesSection.classList.remove('hidden');
            } else {
                notesSection.classList.add('hidden');
            }
            
            const lastUpdated = new Date(statusData.last_updated);
            
            // Format as "August 18th, 2025 11:53:04AM"
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
            
            const day = lastUpdated.getDate();
            const suffix = day % 10 === 1 && day !== 11 ? 'st' : 
                          day % 10 === 2 && day !== 12 ? 'nd' : 
                          day % 10 === 3 && day !== 13 ? 'rd' : 'th';
            
            const month = months[lastUpdated.getMonth()];
            const year = lastUpdated.getFullYear();
            const hours = lastUpdated.getHours();
            const minutes = lastUpdated.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? ' PM' : ' AM';
            const displayHours = hours % 12 || 12;
            
            const formattedTime = `${month} ${day}${suffix}, ${year} ${displayHours}:${minutes}${ampm}`;
            document.getElementById('lastUpdated').textContent = `Last updated: ${formattedTime}`;

            if (statusData.source === 'demo') {
                const demoIndicator = document.createElement('div');
                demoIndicator.className = 'text-sm text-orange-600 mt-2';
                demoIndicator.textContent = '⚠️ Demo mode - Backend not connected';
                statusSubtext.parentNode.appendChild(demoIndicator);
            }
        }

        updateStatus();
        setInterval(updateStatus, 5 * 60 * 1000);
        
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                updateStatus();
            }
        });
    </script>
</body>
</html>